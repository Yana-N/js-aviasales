document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".form-search"),t=document.querySelector(".input__cities-from"),n=document.querySelector(".dropdown__cities-from"),o=document.querySelector(".input__cities-to"),a=document.querySelector(".dropdown__cities-to"),r=document.querySelector(".input__date-depart");let d=[];const s=(e,t)=>{const n=new XMLHttpRequest;n.open("GET",e),n.addEventListener("readystatechange",()=>{4===n.readyState&&(200===n.status?t(n.response):console.error(n.status))}),n.send()},c=(e,t)=>{if(t.textContent="",e.value){d.filter(t=>t.name.toLowerCase().includes(e.value.toLowerCase())).forEach(e=>{const n=document.createElement("li");n.classList.add("dropdown__city"),n.textContent=e.name,t.append(n)})}},i=(e,t,n)=>{const o=e.target,a=o.innerText;"li"===o.tagName.toLowerCase()&&(t.value=a,n.textContent="")};t.addEventListener("input",()=>{c(t,n)}),o.addEventListener("input",()=>{c(o,a)}),n.addEventListener("click",e=>{i(e,t,n)}),a.addEventListener("click",e=>{i(e,o,a)}),e.addEventListener("submit",e=>{e.preventDefault();const n={from:d.find(e=>t.value===e.name).code,to:d.find(e=>o.value===e.name).code,when:r.value};s("https://cors-anywhere.herokuapp.com/http://min-prices.aviasales.ru/calendar_preload"+`?depart_date=${n.when}&origin=${n.from}&destination=${n.to}&one_way=true&token=060f2e07ff83e3a45a39dfcac9669301`,e=>((e,t)=>{const n=JSON.parse(e).best_prices,o=n.filter(e=>e.depart_date===t);o(o),n(n)})(e,n.when))}),s("../db/cities.json",e=>{d=JSON.parse(e).filter(e=>e.name)})}));